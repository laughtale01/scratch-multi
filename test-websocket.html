<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Minecraft WebSocket Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        #log {
            background: #f0f0f0;
            padding: 15px;
            border: 1px solid #ccc;
            height: 400px;
            overflow-y: auto;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>ğŸ® Minecraft WebSocket Test</h1>

    <div>
        <button onclick="connect()">1. æ¥ç¶š</button>
        <button onclick="sendChat()">2. ãƒãƒ£ãƒƒãƒˆé€ä¿¡</button>
        <button onclick="placeBlock()">3. ãƒ–ãƒ­ãƒƒã‚¯é…ç½®</button>
        <button onclick="getBlock()">4. ãƒ–ãƒ­ãƒƒã‚¯å–å¾—</button>
        <button onclick="fillBlocks()">5. ç¯„å›²é…ç½®</button>
        <button onclick="getPosition()">6. ä½ç½®å–å¾—</button>
        <button onclick="setGameMode()">7. ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–</button>
        <button onclick="disconnect()">8. åˆ‡æ–­</button>
    </div>

    <h3>ãƒ­ã‚°ï¼š</h3>
    <div id="log"></div>

    <script>
        let ws = null;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<span class="${type}">[${timestamp}] ${message}</span>\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function connect() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                log('ã™ã§ã«æ¥ç¶šæ¸ˆã¿ã§ã™', 'info');
                return;
            }

            log('æ¥ç¶šä¸­... ws://localhost:14711/minecraft', 'info');
            ws = new WebSocket('ws://localhost:14711/minecraft');

            ws.onopen = () => {
                log('âœ… æ¥ç¶šæˆåŠŸï¼', 'success');

                // æ¥ç¶šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
                const connectMsg = {
                    version: "1.0",
                    messageId: "test-" + Date.now(),
                    timestamp: Date.now(),
                    sessionId: "",
                    type: "connect",
                    payload: {
                        clientId: "browser_test_" + Date.now(),
                        authToken: "test-token",
                        clientInfo: {
                            userAgent: "Browser WebSocket Test",
                            version: "1.0.0"
                        }
                    }
                };
                ws.send(JSON.stringify(connectMsg));
                log('â†’ æ¥ç¶šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡', 'info');
            };

            ws.onmessage = (event) => {
                log('ğŸ“¨ å—ä¿¡: ' + event.data, 'success');
                try {
                    const data = JSON.parse(event.data);
                    log('   ã‚¿ã‚¤ãƒ—: ' + data.type, 'info');
                } catch (e) {}
            };

            ws.onerror = (error) => {
                log('âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿï¼MinecraftãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„', 'error');
                log('   ã‚¨ãƒ©ãƒ¼: ' + error, 'error');
            };

            ws.onclose = () => {
                log('ğŸ”Œ æ¥ç¶šãŒåˆ‡æ–­ã•ã‚Œã¾ã—ãŸ', 'info');
                ws = null;
            };
        }

        function sendChat() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                log('âŒ ã¾ãšæ¥ç¶šã—ã¦ãã ã•ã„', 'error');
                return;
            }

            const chatMsg = {
                version: "1.0",
                messageId: "chat-" + Date.now(),
                timestamp: Date.now(),
                sessionId: "test-session",
                type: "command",
                payload: {
                    action: "chat",
                    params: {
                        message: "Hello from Browser Test!"
                    }
                }
            };

            ws.send(JSON.stringify(chatMsg));
            log('â†’ ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡: "Hello from Browser Test!"', 'info');
            log('   Minecraftã®ãƒãƒ£ãƒƒãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼', 'success');
        }

        function placeBlock() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                log('âŒ ã¾ãšæ¥ç¶šã—ã¦ãã ã•ã„', 'error');
                return;
            }

            const blockMsg = {
                version: "1.0",
                messageId: "block-" + Date.now(),
                timestamp: Date.now(),
                sessionId: "test-session",
                type: "command",
                payload: {
                    action: "setBlock",
                    params: {
                        relativeX: 0,
                        relativeY: 1,
                        relativeZ: 2,
                        blockType: "minecraft:diamond_block"
                    }
                }
            };

            ws.send(JSON.stringify(blockMsg));
            log('â†’ ãƒ–ãƒ­ãƒƒã‚¯é…ç½®ã‚³ãƒãƒ³ãƒ‰é€ä¿¡ï¼ˆç›¸å¯¾åº§æ¨™ ~0 ~1 ~2ï¼‰', 'info');
            log('   ç›®ã®å‰ã«ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ãŒå‡ºç¾ã™ã‚‹ã¯ãšã§ã™ï¼', 'success');
        }

        function getBlock() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                log('âŒ ã¾ãšæ¥ç¶šã—ã¦ãã ã•ã„', 'error');
                return;
            }

            const msg = {
                version: "1.0",
                messageId: "getblock-" + Date.now(),
                timestamp: Date.now(),
                sessionId: "test-session",
                type: "command",
                payload: {
                    action: "getBlock",
                    params: {
                        x: 0,
                        y: 64,
                        z: 0
                    }
                }
            };

            ws.send(JSON.stringify(msg));
            log('â†’ ãƒ–ãƒ­ãƒƒã‚¯å–å¾—ã‚³ãƒãƒ³ãƒ‰é€ä¿¡ï¼ˆ0, 64, 0ï¼‰', 'info');
        }

        function fillBlocks() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                log('âŒ ã¾ãšæ¥ç¶šã—ã¦ãã ã•ã„', 'error');
                return;
            }

            const msg = {
                version: "1.0",
                messageId: "fill-" + Date.now(),
                timestamp: Date.now(),
                sessionId: "test-session",
                type: "command",
                payload: {
                    action: "fillBlocks",
                    params: {
                        from: { x: 0, y: 65, z: 0 },
                        to: { x: 4, y: 67, z: 4 },
                        blockType: "minecraft:gold_block"
                    }
                }
            };

            ws.send(JSON.stringify(msg));
            log('â†’ ç¯„å›²ãƒ–ãƒ­ãƒƒã‚¯é…ç½®ã‚³ãƒãƒ³ãƒ‰é€ä¿¡ï¼ˆ5x3x5ã®é‡‘ãƒ–ãƒ­ãƒƒã‚¯ï¼‰', 'info');
        }

        function getPosition() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                log('âŒ ã¾ãšæ¥ç¶šã—ã¦ãã ã•ã„', 'error');
                return;
            }

            const msg = {
                version: "1.0",
                messageId: "pos-" + Date.now(),
                timestamp: Date.now(),
                sessionId: "test-session",
                type: "command",
                payload: {
                    action: "getPosition",
                    params: {}
                }
            };

            ws.send(JSON.stringify(msg));
            log('â†’ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½ç½®å–å¾—ã‚³ãƒãƒ³ãƒ‰é€ä¿¡', 'info');
        }

        function setGameMode() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                log('âŒ ã¾ãšæ¥ç¶šã—ã¦ãã ã•ã„', 'error');
                return;
            }

            const msg = {
                version: "1.0",
                messageId: "gamemode-" + Date.now(),
                timestamp: Date.now(),
                sessionId: "test-session",
                type: "command",
                payload: {
                    action: "setGameMode",
                    params: {
                        mode: "creative"
                    }
                }
            };

            ws.send(JSON.stringify(msg));
            log('â†’ ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰å¤‰æ›´ã‚³ãƒãƒ³ãƒ‰é€ä¿¡ï¼ˆã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ï¼‰', 'info');
        }

        function disconnect() {
            if (ws) {
                ws.close();
                log('åˆ‡æ–­ã—ã¾ã—ãŸ', 'info');
            } else {
                log('æ¥ç¶šã•ã‚Œã¦ã„ã¾ã›ã‚“', 'info');
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        log('=== Minecraft WebSocket ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ï¼ˆæ‹¡å¼µç‰ˆï¼‰ ===', 'success');
        log('1. Minecraftã‚’èµ·å‹•ã—ã¦ãƒ¯ãƒ¼ãƒ«ãƒ‰ã«å…¥ã£ã¦ãã ã•ã„', 'info');
        log('2. ã€Œ1. æ¥ç¶šã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯', 'info');
        log('3. å„ã‚³ãƒãƒ³ãƒ‰ã‚’è©¦ã—ã¦ãã ã•ã„ï¼š', 'info');
        log('   - ãƒãƒ£ãƒƒãƒˆé€ä¿¡: ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º', 'info');
        log('   - ãƒ–ãƒ­ãƒƒã‚¯é…ç½®: ç›®ã®å‰ã«ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯', 'info');
        log('   - ãƒ–ãƒ­ãƒƒã‚¯å–å¾—: åº§æ¨™(0,64,0)ã®ãƒ–ãƒ­ãƒƒã‚¯æƒ…å ±å–å¾—', 'info');
        log('   - ç¯„å›²é…ç½®: 5x3x5ã®é‡‘ãƒ–ãƒ­ãƒƒã‚¯ã‚’é…ç½®', 'info');
        log('   - ä½ç½®å–å¾—: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç¾åœ¨ä½ç½®ã‚’å–å¾—', 'info');
        log('   - ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–: ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã«å¤‰æ›´', 'info');
        log('', 'info');
    </script>
</body>
</html>
